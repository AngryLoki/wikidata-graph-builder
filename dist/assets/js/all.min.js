(function(){var t=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};!function(){var e,r,n,i,a,o,s,d;return n=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},s=function(t){return t.itemLabel&&t.itemLabel.value||t.item.value.startsWith("http://www.wikidata.org/entity/")&&t.item.value.slice(31)||t.item.value},o=function(t,e,r){var n,i,a,o,d,l,u,c,m,p,h,f,g,w,v,y,q,k,x,b;for(n=t.results.bindings,f={},c=0,m=n.length;m>c;c++)l=n[c],f[l.item.value]={name:s(l),url:l.item.value,has_link:!!l.linkTo};h=function(){var t,e,r,i;for(i=[],t=0,e=n.length;e>t;t++)l=n[t],f[null!=(r=l.linkTo)?r.value:void 0]&&i.push({source:f[l.item.value],target:f[l.linkTo.value]});return i}(),k=function(t){return"translate("+t.x+","+t.y+")"},q=function(){p.attr({x1:function(t){return t.source.x},y1:function(t){return t.source.y},x2:function(t){return t.target.x},y2:function(t){return t.target.y}}),i.attr({transform:k}),y.attr({transform:k})},g=function(){var t,e,r;e=document.getElementsByTagName("md-toolbar")[0].offsetHeight,r=window.innerWidth,t=window.innerHeight-e,w.attr({width:r,height:t}),d.attr({width:r,height:t}),u.size([r,t]).resume()},b=function(){a.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")},x=d3.behavior.zoom().on("zoom",b),u=d3.layout.force(),o=u.drag().on("dragstart",function(){d3.event.sourceEvent.stopPropagation()}),u.nodes(d3.values(f)).links(h).linkDistance(30).charge(-200).gravity(.05).on("tick",q).start(),w=d3.select("svg#graph").attr("pointer-events","all"),w.selectAll("*").remove(),w.append("defs").selectAll("marker").data(["direction"]).enter().append("marker").attr({id:function(t){return t},viewBox:"0 -5 10 10",refX:15,markerWidth:6,markerHeight:6,orient:"auto"}).append("path").attr({d:"M0,-5L10,0L0,5"}),v=w.append("g").attr("transform","translate(0,0)").call(x),d=v.append("rect").style("fill","none"),a=v.append("g"),p=a.append("g").selectAll("line").data(u.links()).enter().append("line").attr({"marker-end":"url(#direction)"}),i=a.append("g").selectAll("circle").data(u.nodes()).enter().append("circle").attr({r:6}).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),"undirected"===r&&i.classed("linked",function(t){return t.has_link}),i.classed("active",function(t){return t.url.endsWith(e)}),i.call(o),y=a.append("g").selectAll("text").data(u.nodes()).enter().append("text").attr({x:8,y:".31em"}).text(function(t){return t.name}).on("click",function(t){window.open(t.url)}),g(),d3.select(window).on("resize",g)},d=function(t){return 0!==t.limit||0!==t.iterations||"undirected"===t.mode},a=function(t,e){return null==e&&(e=t.mode),"both"===e?"{ "+a(t,"forward")+" } UNION { "+a(t,"reverse")+" }":d(t)?'SERVICE gas:service {\n    gas:program gas:gasClass "com.bigdata.rdf.graph.analytics.SSSP" ;\n                gas:in wd:'+t.item+' ;\n                gas:traversalDirection "'+n(e)+'" ;\n                gas:out ?item ;\n                gas:out1 ?depth ;'+(0===t.iterations?"":"\n                gas:maxIterations "+t.iterations+" ;")+(0===t.limit?"":"\n                gas:maxVisited "+t.limit+" ;")+"\n                gas:linkType wdt:"+t.property+" .\n  }":"forward"===e?"wd:"+t.item+" wdt:"+t.property+"* ?item":"reverse"===e?"?item wdt:"+t.property+"* wd:"+t.item:void 0},i=function(t){var e;if(t.item&&t.property)return e=d(t)?"PREFIX gas: <http://www.bigdata.com/rdf/gas#>\n\n":"",e+("SELECT ?item ?itemLabel ?linkTo {\n  "+a(t)+"\n  OPTIONAL { ?item wdt:"+t.property+' ?linkTo }\n  SERVICE wikibase:label {bd:serviceParam wikibase:language "en" }\n}')},e=function(e,r,n,a,s,d,l,u,c,m){var p,h,f,g,w,v,y,q,k,x,b,S;this.modes=[{mode:"forward",text:"Forward"},{mode:"reverse",text:"Reverse"},{mode:"both",text:"Bidirectional"},{mode:"undirected",text:"Undirected"},{mode:"wdqs",text:"WDQS"}],w=function(){var t,e,r,n;for(r=this.modes,n=[],t=0,e=r.length;e>t;t++)p=r[t],n.push(p.mode);return n}.call(this),f=function(){var e,r,n,a;return r=l.search(),e={property:/^P\d+$/.test(r.property||"")?r.property:void 0,item:/^Q\d+$/.test(r.item||"")?r.item:void 0,lang:/^[a-z-]{2,}$/.test(r.lang||"")?r.lang:"en",iterations:/^\d+$/.test(r.iterations||"")?parseInt(r.iterations):0,limit:/^\d+$/.test(r.limit||"")?parseInt(r.limit):0,mode:(n=r.mode,t.call(w,n)>=0?r.mode:(a=r.direction,t.call(w,a)>=0?r.direction:"forward")),wdqs:r.wdqs},e.wdqs||(e.wdqs=i(e)),e},y=function(t){return function(){var e;e=f(),t.lang!==e.lang&&(t.lang=e.lang),(e.item&&!t.item||t.item&&t.item.id!==e.item)&&g(e.item),(e.property&&!t.property||t.property&&t.property.id!==e.property)&&v(e.property),t.iterations!==e.iterations&&(t.iterations=e.iterations),t.limit!==e.limit&&(t.limit=e.limit),t.mode!==e.mode&&(t.mode=e.mode),t.wdqs!==e.wdqs&&(t.wdqs=e.wdqs),e.wdqs&&k(e)}}(this),u.$on("$locationChangeSuccess",y),S=s({format:"json",formatversion:2,callback:"JSON_CALLBACK"}),b="https://www.wikidata.org/w/api.php?"+S,x=function(t){return function(e,r,n){return null==n&&(n=t.lang),{action:"wbsearchentities",search:r,uselang:n,language:n,type:e,"continue":0}}}(this),q=function(t){return function(e,r){return null==r&&(r=t.lang),{action:"wbsearchentities",search:e,uselang:r,language:r,type:e.startsWith("Q")?"item":"property",limit:1}}}(this),g=function(t){return function(e){var r,i;return e?(i=function(e){return t.item=e.data.search[0]},r=function(t){return n.error("Request failed"),reject("Request failed")},void a.jsonp(b,{params:q(e)}).then(i,r)):(t.item=void 0,void(t.itemText=void 0))}}(this),v=function(t){return function(e){var r,i;return e?(i=function(e){return t.property=e.data.search[0]},r=function(t){return n.error("Request failed"),reject("Request failed")},void a.jsonp(b,{params:q(e)}).then(i,r)):(t.property=void 0,void(t.propertyText=void 0))}}(this),this.itemSearch=function(t){return r(function(e,r){var i,o;return o=function(t){return e(t.data.search)},i=function(t){return n.error("Request failed"),r("Request failed")},a.jsonp(b,{params:x("item",t)}).then(o,i)})},this.propertySearch=function(t){return r(function(e,r){var i,o;return o=function(t){return e(t.data.search)},i=function(t){return n.error("Request failed"),r("Request failed")},a.jsonp(b,{params:x("property",t)}).then(o,i)})},this.reset=function(){return l.search({})},this.validate=function(){return"wdqs"===this.mode&&this.wdqs||"wdqs"!==this.mode&&this.property&&this.item&&this.property},this.build=function(){var t;return t={},"wdqs"===this.mode?(t.mode="wdqs",t.wdqs=this.wdqs):(t.property=this.property.id,t.item=this.item.id,"en"!==this.lang&&(t.lang=this.lang),"forward"!==this.mode&&(t.mode=this.mode),0!==this.iterations&&(t.iterations=this.iterations),0!==this.limit&&(t.limit=this.limit)),JSON.stringify(l.search())===JSON.stringify(t)?y():l.search(t)},h=function(t,e){var r;return r=c.simple().textContent(t).hideDelay(5e3),e&&r.action("More info").highlightAction(!0),r=c.show(r).then(function(r){return function(r){var n;return e&&"ok"===r?(n=angular.element("<md-dialog />").attr("aria-label",t).append(angular.element("<pre />").text(e)),m.show({clickOutsideToClose:!0,template:n[0].outerHTML})):void 0}}(this))},k=function(t){return function(e){var r,i,s,d;s=e.wdqs,d=(new Date).getTime(),i=function(r){return t.isLoading=!1,o(r.data,e.item,e.mode)},r=function(e){var r;t.isLoading=!1,n.error("unable to process answer",e.data),r=(new Date).getTime()-d,1e4>r?h("Something is wrong with SPARQL query syntax",e.data):h("SPARQL query times out")},t.isLoading=!0,a.get("https://query.wikidata.org/sparql",{params:{query:s}}).then(i,r),t.showSvg=!0}}(this),this.query=function(){var t;t=f(),window.open("https://query.wikidata.org/#"+encodeURIComponent(t.wdqs))},this.svg=function(){var t,e,r;t=new XMLSerializer,e=t.serializeToString($("svg")[0]),e='<?xml version="1.0" standalone="no"?>\r\n'+e,r="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(e),window.open(r)},this.list=function(){var t,e,r,n;t=f(),n="https://tools.wmflabs.org/wikidata-todo/tree.html?q="+t.item.slice(1),"reverse"!==(e=t.mode)&&"both"!==e||(n+="&rp="+t.property.slice(1)),"forward"!==(r=t.mode)&&"both"!==r||(n+="&p="+t.property.slice(1)),0!==t.iterations&&(n+="&depth="+t.iterations),"en"!==t.lang&&(n+="&lang="+t.lang),window.open(n)}},e.$inject=["$timeout","$q","$log","$http","$httpParamSerializer","$scope","$location","$rootScope","$mdToast","$mdDialog"],r=angular.module("WgbApp",["ngMaterial"]),r.config(["$locationProvider",function(t){t.html5Mode({enabled:!0,requireBase:!1})}]),r.controller("FormCtrl",e)}()}).call(this);