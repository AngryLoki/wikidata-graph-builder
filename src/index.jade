doctype html
html
  head
    link(rel="stylesheet" href="assets/css/angular-material.min.css")
    link(rel="stylesheet" href="assets/css/main.css")
      
    script(src="assets/js/angular.min.js")
    script(src="assets/js/angular-animate.min.js")
    script(src="assets/js/angular-aria.min.js")
    script(src="assets/js/angular-messages.min.js")
    script(src="assets/js/angular-material.min.js")
    script(src="assets/js/d3.min.js")
    script(src="assets/js/all.min.js")

    meta(charset="utf-8")
    meta(name="viewport" content="width=device-width")
    title Wikidata Graph Builder
  body(ng-app="WgbApp" ng-cloak)
    div(layout="column" tabIndex="-1" role="main" flex ng-controller="FormCtrl as ctrl")
      md-toolbar.md-whiteframe-glow-z1.md-hue-1.site-content-toolbar
        .md-toolbar-tools(layout-align="center center")
          h3
            a(href="?" ng-click="ctrl.reset()") WGB
          span(flex)
          
          md-input-container
            label Mode
            md-select(ng-model="ctrl.mode" style="width: 100px")
              md-option(ng-value="mode.mode" ng-repeat="mode in ctrl.modes") {{ mode.text }}

          textarea(ng-model="ctrl.wdqs" ng-show="ctrl.mode === 'wdqs'") query
            
          md-input-container(ng-show="ctrl.mode !== 'wdqs'")
            label Language
            input(ng-model="ctrl.lang" type="text" placeholder="??" size="4" style="width: 50px")

          md-autocomplete(
            required
            ng-show="ctrl.mode !== 'wdqs'"
            md-selected-item="ctrl.item"
            md-search-text="ctrl.itemText"
            md-items="item in ctrl.itemSearch(ctrl.itemText)"
            md-item-text="item.label"
            md-min-length="1"
            placeholder="Item"
            style="width: 190px"
            md-menu-class="autocomplete-header-template"
          )
            md-item-template
              span.item-label {{item.label}}
              span.item-description {{item.description}}
            md-not-found
              | No items matching "{{ctrl.searchText}}"

          md-autocomplete(
            required
            ng-show="ctrl.mode !== 'wdqs'"
            md-selected-item="ctrl.property"
            md-search-text="ctrl.propertyText"
            md-items="item in ctrl.propertySearch(ctrl.propertyText)"
            md-item-text="item.label"
            md-min-length="1"
            placeholder="Property"
            style="width: 190px"
            md-menu-class="autocomplete-header-template"
          )
            md-item-template
              span.item-label {{item.label}}
              span.item-description {{item.description}}
            md-not-found
              | No properties matching "{{ctrl.searchText}}"
          
          md-input-container(ng-show="ctrl.mode !== 'wdqs'")
            label(for="iterations") Iterations
            input(
              ng-model="ctrl.iterations" type="number" value="0" min="0" 
              style="width: 50px")
          
          md-input-container(ng-show="ctrl.mode !== 'wdqs'")
            label Limit
            input(
              ng-model="ctrl.limit" type="number" value="0" min="0" 
              size="2" style="width: 50px")
          
          md-button.md-primary.md-raised(
            ng-click="ctrl.build()"
            ng-disabled="!ctrl.validate()"
          ) Build
          
          md-menu(md-position-mode="target-right target")
            md-button.md-raised(
              ng-disabled="!ctrl.validate()"
              ng-click="$mdOpenMenu($event)"
            ) Tools
            md-menu-content(width="4")
              md-menu-item
                md-button(ng-click="ctrl.query()" ng-disabled="!ctrl.validate()") Wikidata Query Service
              md-menu-item
                md-button(ng-click="ctrl.list()" ng-disabled="!(ctrl.validate() && (ctrl.mode == 'forward' || ctrl.mode == 'reverse'))") Wikidata generic tree

          
          span(flex)
      
      md-progress-linear(md-mode="query" ng-show="ctrl.isLoading")
        | 

      md-content(ng-hide="ctrl.showSvg" md-scroll-y layout="column" flex layout-padding)
        div.main-content
          h1.md-display-2 Wikidata Graph Builder

          noscript
            | Wikidata Graph Builder requires JavaScript to be enabled

          p 
            | Build graphs using #[a(href="https://www.wikidata.org") Wikidata] #[a(href="https://query.wikidata.org/") Query Service] and
            |  
            | #[a(href="https://d3js.org/") d3.js]. 
          p Example graphs:
          
          -
            links = [
              ['Parent taxons of Blue Whale', '?property=P171&item=Q42196'],
              ['Class tree for human', '?property=P279&item=Q5'],
              ['Parents of Nikita Mikhalkov', '?property=P40&item=Q55207&mode=reverse'],
              ['Children of Agnes of the Palatinate (4 generations)', '?property=P40&item=Q4450926&iterations=4'],
              ['Types of numbers', '?property=P279&item=Q11563&mode=reverse'],
              ['Subclasses of physicists', '?property=P279&item=Q169470&lang=en&mode=reverse'],
              ['Subclasses and parent classes of period 2 elements', '?property=P279&item=Q207712&mode=both'],
              ['People, who were filmed with Jim Carrey', '?property=P161&item=Q40504&mode=undirected&iterations=2'],
              ['Connectivity of the USA states', '?mode=wdqs&wdqs=SELECT%20%3Fitem%20%3FitemLabel%20%3FlinkTo%20%7B%0A%20%20%3Fitem%20wdt:P31%20wd:Q35657%20.%0A%20%20OPTIONAL%20%7B%20%3FlinkTo%20wdt:P47%20%3Fitem%20;%20wdt:P31%20wd:Q35657%20%7D%20.%0A%0A%20%20SERVICE%20wikibase:label%20%7Bbd:serviceParam%20wikibase:language%20"en"%20%7D%0A%7D']
            ]
          
          ul
            each link in links
              li #[a(href=link[1])=link[0]]
              
          p.footer The source code released under #[a(href="http://opensource.org/licenses/MIT") MIT license] at #[a(href="https://github.com/AngryLoki/wikidata-tree-builder") GitHub].

      svg(id="graph" ng-show="ctrl.showSvg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink")
