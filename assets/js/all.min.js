(function(){var t,e,n;n=function(t){return t.itemLabel&&t.itemLabel.value||t.item.value.startsWith("http://www.wikidata.org/entity/")&&t.item.value.slice(31)||t.item.value},e=function(t,e,r,a){var i,l,o,c,u,s,d,p,f,m,g,h,v,w,k,x,y,A,b,z;if(t.selectAll("*").remove(),e){for(w=t.append("svg").attr({xmlns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"}),i=e.results.bindings,h={},p=0,f=i.length;f>p;p++)s=i[p],h[s.item.value]={name:n(s),url:s.item.value,has_link:!!s.linkTo};g=function(){var t,e,n,r;for(r=[],t=0,e=i.length;e>t;t++)s=i[t],h[null!=(n=s.linkTo)?n.value:void 0]&&r.push({source:h[s.item.value],target:h[s.linkTo.value]});return r}(),A=function(t){return"translate("+t.x+","+t.y+")"},y=function(){m.attr({x1:function(t){return t.source.x},y1:function(t){return t.source.y},x2:function(t){return t.target.x},y2:function(t){return t.target.y}}),l.attr({transform:A}),x.attr({transform:A})},z=function(){o.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")},b=d3.behavior.zoom().on("zoom",z),d=d3.layout.force(),c=d.drag().on("dragstart",function(){d3.event.sourceEvent.stopPropagation()}),d.nodes(d3.values(h)).links(g).linkDistance(30).charge(-200).gravity(.05).on("tick",y).start(),w.attr("pointer-events","all"),w.selectAll("*").remove(),w.append("defs").selectAll("marker").data(["direction"]).enter().append("marker").attr({id:function(t){return t},viewBox:"0 -5 10 10",refX:15,markerWidth:6,markerHeight:6,orient:"auto"}).append("path").attr({d:"M0,-5L10,0L0,5"}),k=w.append("g").attr("transform","translate(0,0)").call(b),u=k.append("rect").style("fill","none"),o=k.append("g"),m=o.append("g").selectAll("line").data(d.links()).enter().append("line").attr({"marker-end":"url(#direction)"}),l=o.append("g").selectAll("circle").data(d.nodes()).enter().append("circle").attr({r:6}).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),"undirected"===a&&l.classed("linked",function(t){return t.has_link}),l.classed("active",function(t){return t.url.endsWith(r)}),l.call(c),x=o.append("g").selectAll("text").data(d.nodes()).enter().append("text").attr({x:8,y:".31em"}).text(function(t){return t.name}).on("click",function(t){window.open(t.url)}),v=function(){var e,n,r;n=document.getElementsByTagName("md-toolbar")[0].offsetHeight,r=window.innerWidth,e=window.innerHeight-n,t.style({height:e+"px"}),w.attr({width:r,height:e}),u.attr({width:r,height:e}),d.size([r,e]).resume()},v(),d3.select(window).on("resize",v)}},t=angular.module("Graph",[]),t.directive("graph",function(){return{restrict:"E",replace:!1,scope:{graphData:"=",activeItem:"=",mode:"="},link:function(t,n,r){t.$watch("graphData",function(r,a){var i;return i=d3.select(n[0]),e(i,t.graphData,t.activeItem,t.mode)})}}})}).call(this);
(function(){var t,e;t=angular.module("WikiTools",[]),e=function(t,e,i){var r,a;r=this,a=i({format:"json",formatversion:2,callback:"JSON_CALLBACK"}),this.createApi=function(t,e){var i;return e||(i=["www",t],t=i[0],e=i[1]),"https://"+t+"."+e+".org/w/api.php?"+a},this.wikidata=this.createApi("wikidata"),this.get=function(t,i){return e.jsonp(t,{params:i})},this.searchEntities=function(e,i,a){var n,s,u;return s={action:"wbsearchentities",search:i,uselang:a,language:a,type:e,"continue":0},u=function(t){return function(t){return t.data.search}}(this),n=function(e){return t.error("Request failed"),reject("Request failed")},r.get(r.wikidata,s).then(u,n)},this.getEntity=function(e,i){var a,n,s;return n={action:"wbsearchentities",search:e,uselang:i,language:i,type:e.startsWith("Q")?"item":"property",limit:1},s=function(t){return function(t){return t.data.search[0]}}(this),a=function(e){return t.error("Request failed"),reject("Request failed")},r.get(r.wikidata,n).then(s,a)},this.wdqs=function(t){return e.get("https://query.wikidata.org/sparql",{params:{query:t}})}},e.$inject=["$log","$http","$httpParamSerializer"],t.service("WikiToolsService",e)}).call(this);
(function(){var t,e,i,r,n,o,a=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1};i=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},o=function(t){return 0!==t.limit||0!==t.iterations||"undirected"===t.mode},n=function(t,e){return null==e&&(e=t.mode),"both"===e?"{ "+n(t,"forward")+" } UNION { "+n(t,"reverse")+" }":o(t)?'SERVICE gas:service {\n    gas:program gas:gasClass "com.bigdata.rdf.graph.analytics.SSSP" ;\n                gas:in wd:'+t.item+' ;\n                gas:traversalDirection "'+i(e)+'" ;\n                gas:out ?item ;\n                gas:out1 ?depth ;'+(0===t.iterations?"":"\n                gas:maxIterations "+t.iterations+" ;")+(0===t.limit?"":"\n                gas:maxVisited "+t.limit+" ;")+"\n                gas:linkType wdt:"+t.property+" .\n  }":"forward"===e?"wd:"+t.item+" wdt:"+t.property+"* ?item":"reverse"===e?"?item wdt:"+t.property+"* wd:"+t.item:void 0},r=function(t){var e;if(t.item&&t.property)return e=o(t)?"PREFIX gas: <http://www.bigdata.com/rdf/gas#>\n\n":"",e+("SELECT ?item ?itemLabel ?linkTo {\n  "+n(t)+"\n  OPTIONAL { ?item wdt:"+t.property+' ?linkTo }\n  SERVICE wikibase:label {bd:serviceParam wikibase:language "'+t.lang+'" }\n}')},t=function(t,e,i,n,o,s){var d,l,m,h,p,u,c,g;this.modes=[{mode:"forward",text:"Forward"},{mode:"reverse",text:"Reverse"},{mode:"both",text:"Bidirectional"},{mode:"undirected",text:"Undirected"},{mode:"wdqs",text:"WDQS"}],p=function(){var t,e,i,r;for(i=this.modes,r=[],t=0,e=i.length;e>t;t++)d=i[t],r.push(d.mode);return r}.call(this),m=function(){var t,i,n,o;return i=e.search(),t={property:/^P\d+$/.test(i.property||"")?i.property:void 0,item:/^Q\d+$/.test(i.item||"")?i.item:void 0,lang:/^[a-z-]{2,}$/.test(i.lang||"")?i.lang:"en",iterations:/^\d+$/.test(i.iterations||"")?parseInt(i.iterations):0,limit:/^\d+$/.test(i.limit||"")?parseInt(i.limit):0,mode:(n=i.mode,a.call(p,n)>=0?i.mode:(o=i.direction,a.call(p,o)>=0?i.direction:"forward")),wdqs:i.wdqs},t.wdqs||(t.wdqs=r(t)),t},c=function(t){return function(){var e;e=m(),t.lang!==e.lang&&(t.lang=e.lang),(e.item&&!t.item||t.item&&t.item.id!==e.item)&&h(e.item),(e.property&&!t.property||t.property&&t.property.id!==e.property)&&u(e.property),t.iterations!==e.iterations&&(t.iterations=e.iterations),t.limit!==e.limit&&(t.limit=e.limit),t.mode!==e.mode&&(t.mode=e.mode),t.wdqs!==e.wdqs&&(t.wdqs=e.wdqs),e.wdqs&&g(e)}}(this),i.$on("$locationChangeSuccess",c),h=function(t){return function(e){return e?void s.getEntity(e,t.lang).then(function(e){return t.item=e}):t.item=t.itemText=void 0}}(this),u=function(t){return function(e){return e?void s.getEntity(e,t.lang).then(function(e){return t.property=e}):t.property=t.propertyText=void 0}}(this),this.itemSearch=function(t){return s.searchEntities("item",t,this.lang)},this.propertySearch=function(t){return s.searchEntities("property",t,this.lang)},this.reset=function(){return this.graphData=null,e.search({})},this.validate=function(){return"wdqs"===this.mode&&this.wdqs||"wdqs"!==this.mode&&this.property&&this.item&&this.property},this.build=function(){var t;return t={},"forward"!==this.mode&&(t.mode=this.mode),"wdqs"===this.mode?t.wdqs=this.wdqs:(t.property=this.property.id,t.item=this.item.id,"en"!==this.lang&&(t.lang=this.lang),0!==this.iterations&&(t.iterations=this.iterations),0!==this.limit&&(t.limit=this.limit)),JSON.stringify(e.search())===JSON.stringify(t)?c():e.search(t)},l=function(t,e){var i;return i=n.simple().textContent(t).hideDelay(5e3),e&&i.action("More info").highlightAction(!0),i=n.show(i).then(function(i){return function(i){var r;return e&&"ok"===i?(r=angular.element("<md-dialog />").attr("aria-label",t).append(angular.element("<pre />").text(e)),o.show({clickOutsideToClose:!0,template:r[0].outerHTML})):void 0}}(this))},g=function(e){return function(i){var r,n,o,a;o=i.wdqs,a=(new Date).getTime(),n=function(t){return e.isLoading=!1,e.activeItem=i.item,e.graphData=t.data},r=function(i){var r;e.isLoading=!1,t.error("unable to process answer",i.data),r=(new Date).getTime()-a,1e4>r?l("Something is wrong with SPARQL query syntax",i.data):l("SPARQL query times out")},e.isLoading=!0,s.wdqs(o).then(n,r),e.showSvg=!0}}(this),this.query=function(){var t;t=m(),window.open("https://query.wikidata.org/#"+encodeURIComponent(t.wdqs))},this.svg=function(){var t,e,i;t=new XMLSerializer,e=t.serializeToString($("svg")[0]),e='<?xml version="1.0" standalone="no"?>\r\n'+e,i="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(e),window.open(i)},this.list=function(){var t,e,i,r;t=m(),r="https://tools.wmflabs.org/wikidata-todo/tree.html?q="+t.item.slice(1),"reverse"!==(e=t.mode)&&"both"!==e||(r+="&rp="+t.property.slice(1)),"forward"!==(i=t.mode)&&"both"!==i||(r+="&p="+t.property.slice(1)),0!==t.iterations&&(r+="&depth="+t.iterations),"en"!==t.lang&&(r+="&lang="+t.lang),window.open(r)}},t.$inject=["$log","$location","$rootScope","$mdToast","$mdDialog","WikiToolsService"],e=angular.module("WgbApp",["ngMaterial","WikiTools","Graph"]),e.config(["$locationProvider",function(t){t.html5Mode({enabled:!0,requireBase:!1})}]),e.controller("FormCtrl",t)}).call(this);