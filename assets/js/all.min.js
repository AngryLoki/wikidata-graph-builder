(function(){var t,e;t=angular.module("WikiTools",[]),e=function(t,e,i){var r,a;r=this,a=i({format:"json",formatversion:2,callback:"JSON_CALLBACK"}),this.createApi=function(t,e){var i;return e||(i=["www",t],t=i[0],e=i[1]),"https://"+t+"."+e+".org/w/api.php?"+a},this.wikidata=this.createApi("wikidata"),this.get=function(t,i){return e.jsonp(t,{params:i})},this.searchEntities=function(e,i,a){var n,s,u;return s={action:"wbsearchentities",search:i,uselang:a,language:a,type:e,"continue":0},u=function(t){return function(t){return t.data.search}}(this),n=function(e){return t.error("Request failed"),reject("Request failed")},r.get(r.wikidata,s).then(u,n)},this.getEntity=function(e,i){var a,n,s;return n={action:"wbsearchentities",search:e,uselang:i,language:i,type:e.startsWith("Q")?"item":"property",limit:1},s=function(t){return function(t){return t.data.search[0]}}(this),a=function(e){return t.error("Request failed"),reject("Request failed")},r.get(r.wikidata,n).then(s,a)},this.wdqs=function(t){return e.get("https://query.wikidata.org/sparql",{params:{query:t}})}},e.$inject=["$log","$http","$httpParamSerializer"],t.service("WikiToolsService",e)}).call(this);
(function(){var t=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1};!function(){var e,i,n,r,o,a,s,d;return n=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},s=function(t){return t.itemLabel&&t.itemLabel.value||t.item.value.startsWith("http://www.wikidata.org/entity/")&&t.item.value.slice(31)||t.item.value},a=function(t,e,i){var n,r,o,a,d,l,u,c,m,p,h,g,f,w,v,y,k,x,q,b;for(n=t.results.bindings,g={},c=0,m=n.length;m>c;c++)l=n[c],g[l.item.value]={name:s(l),url:l.item.value,has_link:!!l.linkTo};h=function(){var t,e,i,r;for(r=[],t=0,e=n.length;e>t;t++)l=n[t],g[null!=(i=l.linkTo)?i.value:void 0]&&r.push({source:g[l.item.value],target:g[l.linkTo.value]});return r}(),x=function(t){return"translate("+t.x+","+t.y+")"},k=function(){p.attr({x1:function(t){return t.source.x},y1:function(t){return t.source.y},x2:function(t){return t.target.x},y2:function(t){return t.target.y}}),r.attr({transform:x}),y.attr({transform:x})},f=function(){var t,e,i;e=document.getElementsByTagName("md-toolbar")[0].offsetHeight,i=window.innerWidth,t=window.innerHeight-e,w.attr({width:i,height:t}),d.attr({width:i,height:t}),u.size([i,t]).resume()},b=function(){o.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")},q=d3.behavior.zoom().on("zoom",b),u=d3.layout.force(),a=u.drag().on("dragstart",function(){d3.event.sourceEvent.stopPropagation()}),u.nodes(d3.values(g)).links(h).linkDistance(30).charge(-200).gravity(.05).on("tick",k).start(),w=d3.select("svg#graph").attr("pointer-events","all"),w.selectAll("*").remove(),w.append("defs").selectAll("marker").data(["direction"]).enter().append("marker").attr({id:function(t){return t},viewBox:"0 -5 10 10",refX:15,markerWidth:6,markerHeight:6,orient:"auto"}).append("path").attr({d:"M0,-5L10,0L0,5"}),v=w.append("g").attr("transform","translate(0,0)").call(q),d=v.append("rect").style("fill","none"),o=v.append("g"),p=o.append("g").selectAll("line").data(u.links()).enter().append("line").attr({"marker-end":"url(#direction)"}),r=o.append("g").selectAll("circle").data(u.nodes()).enter().append("circle").attr({r:6}).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),"undirected"===i&&r.classed("linked",function(t){return t.has_link}),r.classed("active",function(t){return t.url.endsWith(e)}),r.call(a),y=o.append("g").selectAll("text").data(u.nodes()).enter().append("text").attr({x:8,y:".31em"}).text(function(t){return t.name}).on("click",function(t){window.open(t.url)}),f(),d3.select(window).on("resize",f)},d=function(t){return 0!==t.limit||0!==t.iterations||"undirected"===t.mode},o=function(t,e){return null==e&&(e=t.mode),"both"===e?"{ "+o(t,"forward")+" } UNION { "+o(t,"reverse")+" }":d(t)?'SERVICE gas:service {\n    gas:program gas:gasClass "com.bigdata.rdf.graph.analytics.SSSP" ;\n                gas:in wd:'+t.item+' ;\n                gas:traversalDirection "'+n(e)+'" ;\n                gas:out ?item ;\n                gas:out1 ?depth ;'+(0===t.iterations?"":"\n                gas:maxIterations "+t.iterations+" ;")+(0===t.limit?"":"\n                gas:maxVisited "+t.limit+" ;")+"\n                gas:linkType wdt:"+t.property+" .\n  }":"forward"===e?"wd:"+t.item+" wdt:"+t.property+"* ?item":"reverse"===e?"?item wdt:"+t.property+"* wd:"+t.item:void 0},r=function(t){var e;if(t.item&&t.property)return e=d(t)?"PREFIX gas: <http://www.bigdata.com/rdf/gas#>\n\n":"",e+("SELECT ?item ?itemLabel ?linkTo {\n  "+o(t)+"\n  OPTIONAL { ?item wdt:"+t.property+' ?linkTo }\n  SERVICE wikibase:label {bd:serviceParam wikibase:language "'+t.lang+'" }\n}')},e=function(e,i,n,o,s,d,l){var u,c,m,p,h,g,f,w;this.modes=[{mode:"forward",text:"Forward"},{mode:"reverse",text:"Reverse"},{mode:"both",text:"Bidirectional"},{mode:"undirected",text:"Undirected"},{mode:"wdqs",text:"WDQS"}],h=function(){var t,e,i,n;for(i=this.modes,n=[],t=0,e=i.length;e>t;t++)u=i[t],n.push(u.mode);return n}.call(this),m=function(){var e,i,o,a;return i=n.search(),e={property:/^P\d+$/.test(i.property||"")?i.property:void 0,item:/^Q\d+$/.test(i.item||"")?i.item:void 0,lang:/^[a-z-]{2,}$/.test(i.lang||"")?i.lang:"en",iterations:/^\d+$/.test(i.iterations||"")?parseInt(i.iterations):0,limit:/^\d+$/.test(i.limit||"")?parseInt(i.limit):0,mode:(o=i.mode,t.call(h,o)>=0?i.mode:(a=i.direction,t.call(h,a)>=0?i.direction:"forward")),wdqs:i.wdqs},e.wdqs||(e.wdqs=r(e)),e},f=function(t){return function(){var e;e=m(),t.lang!==e.lang&&(t.lang=e.lang),(e.item&&!t.item||t.item&&t.item.id!==e.item)&&p(e.item),(e.property&&!t.property||t.property&&t.property.id!==e.property)&&g(e.property),t.iterations!==e.iterations&&(t.iterations=e.iterations),t.limit!==e.limit&&(t.limit=e.limit),t.mode!==e.mode&&(t.mode=e.mode),t.wdqs!==e.wdqs&&(t.wdqs=e.wdqs),e.wdqs&&w(e)}}(this),o.$on("$locationChangeSuccess",f),p=function(t){return function(e){var i;return e?(i=function(e){return t.item=e},void l.getEntity(e,t.lang).then(i)):(t.item=void 0,void(t.itemText=void 0))}}(this),g=function(t){return function(e){var i;return e?(i=function(e){return t.property=e},void l.getEntity(e,t.lang).then(i)):(t.property=void 0,void(t.propertyText=void 0))}}(this),this.itemSearch=function(t){return l.searchEntities("item",t,this.lang)},this.propertySearch=function(t){return l.searchEntities("property",t,this.lang)},this.reset=function(){return n.search({})},this.validate=function(){return"wdqs"===this.mode&&this.wdqs||"wdqs"!==this.mode&&this.property&&this.item&&this.property},this.build=function(){var t;return t={},"wdqs"===this.mode?(t.mode="wdqs",t.wdqs=this.wdqs):(t.property=this.property.id,t.item=this.item.id,"en"!==this.lang&&(t.lang=this.lang),"forward"!==this.mode&&(t.mode=this.mode),0!==this.iterations&&(t.iterations=this.iterations),0!==this.limit&&(t.limit=this.limit)),JSON.stringify(n.search())===JSON.stringify(t)?f():n.search(t)},c=function(t,e){var i;return i=s.simple().textContent(t).hideDelay(5e3),e&&i.action("More info").highlightAction(!0),i=s.show(i).then(function(i){return function(i){var n;return e&&"ok"===i?(n=angular.element("<md-dialog />").attr("aria-label",t).append(angular.element("<pre />").text(e)),d.show({clickOutsideToClose:!0,template:n[0].outerHTML})):void 0}}(this))},w=function(t){return function(i){var n,r,o,s;o=i.wdqs,s=(new Date).getTime(),r=function(e){return t.isLoading=!1,a(e.data,i.item,i.mode)},n=function(i){var n;t.isLoading=!1,e.error("unable to process answer",i.data),n=(new Date).getTime()-s,1e4>n?c("Something is wrong with SPARQL query syntax",i.data):c("SPARQL query times out")},t.isLoading=!0,l.wdqs(o).then(r,n),t.showSvg=!0}}(this),this.query=function(){var t;t=m(),window.open("https://query.wikidata.org/#"+encodeURIComponent(t.wdqs))},this.svg=function(){var t,e,i;t=new XMLSerializer,e=t.serializeToString($("svg")[0]),e='<?xml version="1.0" standalone="no"?>\r\n'+e,i="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(e),window.open(i)},this.list=function(){var t,e,i,n;t=m(),n="https://tools.wmflabs.org/wikidata-todo/tree.html?q="+t.item.slice(1),"reverse"!==(e=t.mode)&&"both"!==e||(n+="&rp="+t.property.slice(1)),"forward"!==(i=t.mode)&&"both"!==i||(n+="&p="+t.property.slice(1)),0!==t.iterations&&(n+="&depth="+t.iterations),"en"!==t.lang&&(n+="&lang="+t.lang),window.open(n)}},e.$inject=["$log","$scope","$location","$rootScope","$mdToast","$mdDialog","WikiToolsService"],i=angular.module("WgbApp",["ngMaterial","WikiTools"]),i.config(["$locationProvider",function(t){t.html5Mode({enabled:!0,requireBase:!1})}]),i.controller("FormCtrl",e)}()}).call(this);